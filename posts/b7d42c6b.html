<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Spring 之 JPA | coder-xuyong</title><meta name="author" content="coder-xuyong"><meta name="copyright" content="coder-xuyong"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Spring 之 JPAJPA 为对象关系映射提供了一种基于 POJO 的持久化模型。  简化数据持久化代码的开发 为 Java 社区屏蔽不同持久化 API 的差异   Repository 是数据访问的抽象接口，JPA 是这种抽象的具体实现标准  快速入门（1）在 pom.xml 中引入依赖 1234&lt;dependency&gt;    &lt;groupId&gt;org.springf">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring 之 JPA">
<meta property="og:url" content="https://coder-xuyong.github.io/posts/b7d42c6b">
<meta property="og:site_name" content="coder-xuyong">
<meta property="og:description" content="Spring 之 JPAJPA 为对象关系映射提供了一种基于 POJO 的持久化模型。  简化数据持久化代码的开发 为 Java 社区屏蔽不同持久化 API 的差异   Repository 是数据访问的抽象接口，JPA 是这种抽象的具体实现标准  快速入门（1）在 pom.xml 中引入依赖 1234&lt;dependency&gt;    &lt;groupId&gt;org.springf">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://prod-alicdn-community.kurobbs.com/forum/86e33bf60c4d48499faa119f83e96fa120250619.jpg?x-oss-process=image%2Fformat%2Cwebp">
<meta property="article:published_time" content="2025-10-14T02:33:55.000Z">
<meta property="article:modified_time" content="2025-10-25T09:52:26.945Z">
<meta property="article:author" content="coder-xuyong">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="框架">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="JPA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://prod-alicdn-community.kurobbs.com/forum/86e33bf60c4d48499faa119f83e96fa120250619.jpg?x-oss-process=image%2Fformat%2Cwebp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Spring 之 JPA",
  "url": "https://coder-xuyong.github.io/posts/b7d42c6b",
  "image": "https://prod-alicdn-community.kurobbs.com/forum/86e33bf60c4d48499faa119f83e96fa120250619.jpg?x-oss-process=image%2Fformat%2Cwebp",
  "datePublished": "2025-10-14T02:33:55.000Z",
  "dateModified": "2025-10-25T09:52:26.945Z",
  "author": [
    {
      "@type": "Person",
      "name": "coder-xuyong",
      "url": "https://coder-xuyong.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/medias/img/logo.png"><link rel="canonical" href="https://coder-xuyong.github.io/posts/b7d42c6b"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: coder-xuyong","link":"链接: ","source":"来源: coder-xuyong","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring 之 JPA',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/self/custom.css"><link rel="stylesheet" href="/self/progress_bar.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/self/progress_bar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-color: #fafafa;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/medias/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">100</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">97</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">45</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-bars-progress"></i><span> 合集</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/java/"><i class="fa-fw fa-brands fa-java"></i><span> Java</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://prod-alicdn-community.kurobbs.com/forum/86e33bf60c4d48499faa119f83e96fa120250619.jpg?x-oss-process=image%2Fformat%2Cwebp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/medias/img/logo.png" alt="Logo"><span class="site-name">coder-xuyong</span></a><a class="nav-page-title" href="/"><span class="site-name">Spring 之 JPA</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-bars-progress"></i><span> 合集</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/java/"><i class="fa-fw fa-brands fa-java"></i><span> Java</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Spring 之 JPA<a class="post-edit-link" href="https://github.com/coder-xuyong/coder-xuyong.github.io/edit/main/source/_posts/01.Java/03.Frame/01.Spring/02.Spring数据/04.Spring之JPA.md" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-14T02:33:55.000Z" title="发表于 2025-10-14 10:33:55">2025-10-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-25T09:52:26.945Z" title="更新于 2025-10-25 17:52:26">2025-10-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/1-Java/">1.Java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/1-Java/3-Frame/">3.Frame</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/1-Java/3-Frame/1-Spring/">1.Spring</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/1-Java/3-Frame/1-Spring/2-Spring%E6%95%B0%E6%8D%AE/">2.Spring数据</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;已经过了&quot;,&quot;messageNext&quot;:&quot;天自上次更新，文章内容可能已过时。&quot;,&quot;postUpdate&quot;:&quot;2025-10-25 17:52:26&quot;}" hidden></div><h1 id="Spring-之-JPA"><a href="#Spring-之-JPA" class="headerlink" title="Spring 之 JPA"></a>Spring 之 JPA</h1><p>JPA 为对象关系映射提供了一种基于 POJO 的持久化模型。</p>
<ul>
<li>简化数据持久化代码的开发</li>
<li>为 Java 社区屏蔽不同持久化 API 的差异</li>
</ul>
<blockquote>
<p>Repository 是数据访问的抽象接口，JPA 是这种抽象的具体实现标准</p>
</blockquote>
<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><p>（1）在 pom.xml 中引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）设置启动注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 【可选】指定扫描的 Entity 目录，如果不指定，会扫描全部目录</span></span><br><span class="line"><span class="meta">@EntityScan(&quot;io.github.dunwu.springboot.data.jpa&quot;)</span></span><br><span class="line"><span class="comment">// 【可选】指定扫描的 Repository 目录，如果不指定，会扫描全部目录</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories(basePackages = &#123;&quot;io.github.dunwu.springboot.data.jpa&quot;&#125;)</span></span><br><span class="line"><span class="comment">// 【可选】开启 JPA auditing 能力，可以自动赋值一些字段，比如创建时间、最后一次修改时间等等</span></span><br><span class="line"><span class="meta">@EnableJpaAuditing</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据库连接</span></span><br><span class="line"><span class="attr">spring.datasource.url</span> = <span class="string">jdbc:mysql://localhost:3306/spring_tutorial?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf8</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span> = <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.username</span> = <span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span> = <span class="string">root</span></span><br><span class="line"><span class="comment"># 是否打印 JPA SQL 日志</span></span><br><span class="line"><span class="attr">spring.jpa.show-sql</span> = <span class="string">true</span></span><br><span class="line"><span class="comment"># Hibernate的DDL策略</span></span><br><span class="line"><span class="attr">spring.jpa.hibernate.ddl-auto</span> = <span class="string">create-drop</span></span><br></pre></td></tr></table></figure>

<p>（4）定义实体</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(unique = true)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, Integer age, String address, String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(id, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> User)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) o;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (id != <span class="literal">null</span> &amp;&amp; id.equals(user.id)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> name.equals(user.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（5）定义 Repository</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.Query;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.query.Param;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.rest.core.annotation.RepositoryRestResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RepositoryRestResource(collectionResourceRel = &quot;user&quot;, path = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">    User <span class="title function_">findUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名查找用户</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 示例：http://localhost:8080/user/search/findByName?name=lisi</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> User&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">findUserByName</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据邮箱查找用户</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 示例：http://localhost:8080/user/search/findByEmail?email=xxx@163.com</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> email 邮箱</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> User&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Query(&quot;from User u where u.email=:email&quot;)</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">findByEmail</span><span class="params">(<span class="meta">@Param(&quot;email&quot;)</span> String email)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名删除用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteByName</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（6）测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = &#123; DataJpaApplication.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataJpaTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        repository.deleteAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">18</span>, <span class="string">&quot;北京&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>);</span><br><span class="line">        repository.save(user);</span><br><span class="line">        Optional&lt;User&gt; optional = repository.findById(user.getId());</span><br><span class="line">        assertThat(optional).isNotNull();</span><br><span class="line">        assertThat(optional.isPresent()).isTrue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchInsert</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">18</span>, <span class="string">&quot;北京&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">19</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">18</span>, <span class="string">&quot;南京&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;赵六&quot;</span>, <span class="number">20</span>, <span class="string">&quot;武汉&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>));</span><br><span class="line">        repository.saveAll(users);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> repository.count();</span><br><span class="line">        assertThat(count).isEqualTo(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; list = repository.findAll();</span><br><span class="line">        assertThat(list).isNotEmpty().hasSize(<span class="number">4</span>);</span><br><span class="line">        list.forEach(<span class="built_in">this</span>::accept);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(User user)</span> &#123; log.info(user.toString()); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">18</span>, <span class="string">&quot;北京&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">19</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">18</span>, <span class="string">&quot;南京&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;赵六&quot;</span>, <span class="number">20</span>, <span class="string">&quot;武汉&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>));</span><br><span class="line">        repository.saveAll(users);</span><br><span class="line"></span><br><span class="line">        repository.deleteByName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        assertThat(repository.findUserByName(<span class="string">&quot;张三&quot;</span>)).isNull();</span><br><span class="line"></span><br><span class="line">        repository.deleteAll();</span><br><span class="line">        List&lt;User&gt; list = repository.findAll();</span><br><span class="line">        assertThat(list).isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findAllInPage</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">18</span>, <span class="string">&quot;北京&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">19</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">18</span>, <span class="string">&quot;南京&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;赵六&quot;</span>, <span class="number">20</span>, <span class="string">&quot;武汉&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>));</span><br><span class="line">        repository.saveAll(users);</span><br><span class="line"></span><br><span class="line">        <span class="type">PageRequest</span> <span class="variable">pageRequest</span> <span class="operator">=</span> PageRequest.of(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        Page&lt;User&gt; page = repository.findAll(pageRequest);</span><br><span class="line">        assertThat(page).isNotNull();</span><br><span class="line">        assertThat(page.isEmpty()).isFalse();</span><br><span class="line">        assertThat(page.getTotalElements()).isEqualTo(<span class="number">4</span>);</span><br><span class="line">        assertThat(page.getTotalPages()).isEqualTo(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; list = page.get().collect(Collectors.toList());</span><br><span class="line">        System.out.println(<span class="string">&quot;user list: &quot;</span>);</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">oldUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">18</span>, <span class="string">&quot;北京&quot;</span>, <span class="string">&quot;user1@163.com&quot;</span>);</span><br><span class="line">        oldUser.setName(<span class="string">&quot;张三丰&quot;</span>);</span><br><span class="line">        repository.save(oldUser);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">newUser</span> <span class="operator">=</span> repository.findUserByName(<span class="string">&quot;张三丰&quot;</span>);</span><br><span class="line">        assertThat(newUser).isNotNull();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="常用-JPA-注解"><a href="#常用-JPA-注解" class="headerlink" title="常用 JPA 注解"></a>常用 JPA 注解</h2><h3 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h3><h4 id="Entity"><a href="#Entity" class="headerlink" title="@Entity"></a><code>@Entity</code></h4><h4 id="MappedSuperclass"><a href="#MappedSuperclass" class="headerlink" title="@MappedSuperclass"></a><code>@MappedSuperclass</code></h4><p>当多个实体有共同的属性字段，比如说 id，则可以把它提炼出一个父类，并且加上 <code>@MappedSuperclass</code>，则实体基类就可以继承了。</p>
<h4 id="Table"><a href="#Table" class="headerlink" title="@Table"></a><code>@Table</code></h4><p>当实体名和表名不一致时，可以通过 <code>@Table(name=&quot;CUSTOMERS&quot;)</code> 的形式来明确指定一个表名。</p>
<h3 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h3><h4 id="Id"><a href="#Id" class="headerlink" title="@Id"></a><code>@Id</code></h4><p>@Id 注解用于声明一个实体类的属性映射为数据库的主键。</p>
<h4 id="GeneratedValue"><a href="#GeneratedValue" class="headerlink" title="@GeneratedValue"></a><code>@GeneratedValue</code></h4><p><code>@GeneratedValue</code> 用于标注主键的生成策略，通过 <code>strategy</code> 属性指定。</p>
<p>默认情况下，JPA 自动选择一个最适合底层数据库的主键生成策略：SqlServer 对应 identity，MySQL 对应 auto increment。</p>
<p>在 <code>javax.persistence.GenerationType</code> 中定义了以下几种可供选择的策略：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">GenerationType</span> &#123;</span><br><span class="line">    TABLE,</span><br><span class="line">    SEQUENCE,</span><br><span class="line">    IDENTITY,</span><br><span class="line">    AUTO</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>IDENTITY</code>：采用数据库 ID 自增长的方式来自增主键字段，Oracle 不支持这种方式；</li>
<li><code>AUTO</code>： JPA 自动选择合适的策略，是默认选项；</li>
<li><code>SEQUENCE</code>：通过序列产生主键，通过 <code>@SequenceGenerator</code> 注解指定序列名，MySql 不支持这种方式</li>
<li><code>TABLE</code>：通过表产生主键，框架借由表模拟序列产生主键，使用该策略可以使应用更易于数据库移植。</li>
</ul>
<p>也就是如果你没有指定 strategy 属性，默认策略是 AUTO，JPA 会根据你使用的数据库来自动选择策略，比如说我使用的是 mysql 则，自动的主键策略就是 IDENTITY （auto increment）。</p>
<h3 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h3><h4 id="Column"><a href="#Column" class="headerlink" title="@Column"></a><code>@Column</code></h4><p>当你的 entity 属性名和数据库中的字段名不一致，可以使用 <code>@Column</code> 明确指定，它也可以设置一些属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Column(length = 10, nullable = false, unique = true)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Column(columnDefinition = &quot;INT(3)&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> age;</span><br></pre></td></tr></table></figure>

<p><code>@Column</code> 支持的参数：</p>
<ul>
<li><code>unique</code> 属性表示该字段是否为唯一标识，默认为 false。如果表中有一个字段需要唯一标识，则既可以使用该标记，也可以使用 <code>@Table</code> 标记中的 <code>@UniqueConstraint</code>。</li>
<li><code>nullable</code> 属性表示该字段是否可以为 <code>null</code> 值，默认为 true。</li>
<li><code>insertable</code> 属性表示在使用 <code>INSERT</code> 插入数据时，是否需要插入该字段的值。</li>
<li><code>updatable</code> 属性表示在使用 <code>UPDATE</code> 更新数据时，是否需要更新该字段的值。<code>insertable</code> 和 <code>updatable</code> 属性一般多用于只读的属性，例如主键和外键等。这些字段的值通常是自动生成的。</li>
<li><code>columnDefinition</code> 属性表示创建表时，该字段创建的 SQL 语句，一般用于通过 Entity 生成表定义时使用。</li>
<li><code>table</code> 属性表示当映射多个表时，指定表的表中的字段。默认值为主表的表名。</li>
<li><code>length</code> 属性表示字段的长度，当字段的类型为 <code>varchar</code> 时，该属性才有效，默认为 255 个字符。</li>
<li><code>precision</code> 属性和 scale 属性表示精度，当字段类型为 <code>double</code> 时，<code>precision</code> 表示数值的总长度，<code>scale</code> 表示小数点所占的位数。</li>
</ul>
<p><code>@JoinTable</code></p>
<p><code>@JoinColumn</code></p>
<h3 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h3><p>表关系映射（双向映射）</p>
<ul>
<li><code>@OneToOne</code>：一对一关系</li>
<li><code>@OneToMany</code>：一对多</li>
<li><code>@ManyToMany</code>（不推荐使用，而是采用用中间对象，把多对多拆成两个对多一关系）</li>
</ul>
<p>字段映射（单向映射）：</p>
<ul>
<li><code>@Embedded</code>、<code>@Embeddable</code> 嵌入式关系（单向映射）</li>
<li><code>@ElementCollection</code> 集合一对多关系（单向映射）</li>
</ul>
<h4 id="OneToOne"><a href="#OneToOne" class="headerlink" title="@OneToOne"></a><code>@OneToOne</code></h4><p><code>@OneToOne</code> 表示一对一关系</p>
<h4 id="OneToMany"><a href="#OneToMany" class="headerlink" title="@OneToMany"></a><code>@OneToMany</code></h4><p><code>@OneToMany</code> 表示一对多关系</p>
<p><code>@ManyToOne</code></p>
<p><code>@ManyToMany</code></p>
<p><code>OrderBy</code></p>
<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><p>查询方式有：</p>
<ul>
<li><p>方法名字方式查询</p>
</li>
<li><p><code>@Query</code> 注解方式查询</p>
</li>
<li><p>动态 SQL 方式查询</p>
</li>
<li><p>Example 方式查询</p>
</li>
</ul>
<p><code>JpaRepository</code> 提供了如下表所述的内置查询</p>
<ul>
<li><code>List&lt;T&gt; findAll();</code> - 返回所有实体</li>
<li><code>List&lt;T&gt; findAllById(Iterable&lt;ID&gt; var1);</code> - 返回指定 id 的所有实体</li>
<li><code>T getOne(ID var1);</code> - 根据 id 返回对应的实体，如果未找到，则返回空。</li>
<li><code>List&lt;T&gt; findAll(Sort var1);</code> - 返回所有实体，按照指定顺序返回。</li>
<li><code>Page&lt;T&gt; findAll(Pageable var1);</code> - 返回实体列表，实体的 offset 和 limit 通过 pageable 来指定</li>
</ul>
<h3 id="方法名字方式查询方式"><a href="#方法名字方式查询方式" class="headerlink" title="方法名字方式查询方式"></a>方法名字方式查询方式</h3><p>Spring Data 通过查询的方法名和参数名来自动构造一个 JPA QQL 查询。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Integer&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findByName</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法名和参数名要遵守一定的规则，Spring Data JPA 才能自动转换为 JPQL：</p>
<ul>
<li><p>方法名通常包含多个实体属性用于查询，属性之间可以使用 <code>AND</code> 和 <code>OR</code> 连接，也支持 <code>Between</code>、<code>LessThan</code>、<code>GreaterThan</code>、<code>Like</code>；</p>
</li>
<li><p>方法名可以以 <code>findBy</code>、<code>getBy</code>、<code>queryBy</code> 开头；</p>
</li>
<li><p>查询结果可以排序，方法名包含 OrderBy+属性+ASC（DESC）；</p>
</li>
<li><p>可以通过 <code>Top</code>、<code>First</code> 来限定查询的结果集；</p>
</li>
<li><p>一些特殊的参数可以出现在参数列表里，比如 <code>Pageeable</code>、<code>Sort</code></p>
</li>
</ul>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据名字查询，且按照名字升序</span></span><br><span class="line">List&lt;Person&gt; <span class="title function_">findByLastnameOrderByFirstnameAsc</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据名字查询，且使用翻页查询</span></span><br><span class="line">Page&lt;User&gt; <span class="title function_">findByLastname</span><span class="params">(String lastname, Pageable pageable)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询满足条件的前10个用户</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findFirst10ByLastname</span><span class="params">(String lastname, Sort sort)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用And联合查询</span></span><br><span class="line">List&lt;Person&gt; <span class="title function_">findByFirstnameAndLastname</span><span class="params">(String firstname, String lastname)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Or查询</span></span><br><span class="line">List&lt;Person&gt; <span class="title function_">findDistinctPeopleByLastnameOrFirstname</span><span class="params">(String lastname, String firstname)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用like查询，name 必须包含like中的%或者?</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">findByNameLike</span><span class="params">(String name)</span>;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Keyword</th>
<th>Sample</th>
<th>JPQL snippet</th>
</tr>
</thead>
<tbody><tr>
<td><code>And</code></td>
<td><code>findByLastnameAndFirstname</code></td>
<td><code>… where x.lastname = ?1 and x.firstname = ?2</code></td>
</tr>
<tr>
<td><code>Or</code></td>
<td><code>findByLastnameOrFirstname</code></td>
<td><code>… where x.lastname = ?1 or x.firstname = ?2</code></td>
</tr>
<tr>
<td><code>Is,Equals</code></td>
<td><code>findByFirstname,findByFirstnameIs,findByFirstnameEquals</code></td>
<td><code>… where x.firstname = 1?</code></td>
</tr>
<tr>
<td><code>Between</code></td>
<td><code>findByStartDateBetween</code></td>
<td><code>… where x.startDate between 1? and ?2</code></td>
</tr>
<tr>
<td><code>LessThan</code></td>
<td><code>findByAgeLessThan</code></td>
<td><code>… where x.age &lt; ?1</code></td>
</tr>
<tr>
<td><code>LessThanEqual</code></td>
<td><code>findByAgeLessThanEqual</code></td>
<td><code>… where x.age &lt;= ?1</code></td>
</tr>
<tr>
<td><code>GreaterThan</code></td>
<td><code>findByAgeGreaterThan</code></td>
<td><code>… where x.age &gt; ?1</code></td>
</tr>
<tr>
<td><code>GreaterThanEqual</code></td>
<td><code>findByAgeGreaterThanEqual</code></td>
<td><code>… where x.age &gt;= ?1</code></td>
</tr>
<tr>
<td><code>After</code></td>
<td><code>findByStartDateAfter</code></td>
<td><code>… where x.startDate &gt; ?1</code></td>
</tr>
<tr>
<td><code>Before</code></td>
<td><code>findByStartDateBefore</code></td>
<td><code>… where x.startDate &lt; ?1</code></td>
</tr>
<tr>
<td><code>IsNull</code></td>
<td><code>findByAgeIsNull</code></td>
<td><code>… where x.age is null</code></td>
</tr>
<tr>
<td><code>IsNotNull,NotNull</code></td>
<td><code>findByAge(Is)NotNull</code></td>
<td><code>… where x.age not null</code></td>
</tr>
<tr>
<td><code>Like</code></td>
<td><code>findByFirstnameLike</code></td>
<td><code>… where x.firstname like ?1</code></td>
</tr>
<tr>
<td><code>NotLike</code></td>
<td><code>findByFirstnameNotLike</code></td>
<td><code>… where x.firstname not like ?1</code></td>
</tr>
<tr>
<td><code>StartingWith</code></td>
<td><code>findByFirstnameStartingWith</code></td>
<td><code>… where x.firstname like ?1</code> (parameter bound with appended <code>%</code>)</td>
</tr>
<tr>
<td><code>EndingWith</code></td>
<td><code>findByFirstnameEndingWith</code></td>
<td><code>… where x.firstname like ?1</code> (parameter bound with prepended <code>%</code>)</td>
</tr>
<tr>
<td><code>Containing</code></td>
<td><code>findByFirstnameContaining</code></td>
<td><code>… where x.firstname like ?1</code> (parameter bound wrapped in <code>%</code>)</td>
</tr>
<tr>
<td><code>OrderBy</code></td>
<td><code>findByAgeOrderByLastnameDesc</code></td>
<td><code>… where x.age = ?1 order by x.lastname desc</code></td>
</tr>
<tr>
<td><code>Not</code></td>
<td><code>findByLastnameNot</code></td>
<td><code>… where x.lastname &lt;&gt; ?1</code></td>
</tr>
<tr>
<td><code>In</code></td>
<td><code>findByAgeIn(Collection&lt;Age&gt; ages)</code></td>
<td><code>… where x.age in ?1</code></td>
</tr>
<tr>
<td><code>NotIn</code></td>
<td><code>findByAgeNotIn(Collection&lt;Age&gt; age)</code></td>
<td><code>… where x.age not in ?1</code></td>
</tr>
<tr>
<td><code>True</code></td>
<td><code>findByActiveTrue()</code></td>
<td><code>… where x.active = true</code></td>
</tr>
<tr>
<td><code>False</code></td>
<td><code>findByActiveFalse()</code></td>
<td><code>… where x.active = false</code></td>
</tr>
<tr>
<td><code>IgnoreCase</code></td>
<td><code>findByFirstnameIgnoreCase</code></td>
<td><code>… where UPPER(x.firstame) = UPPER(?1)</code></td>
</tr>
</tbody></table>
<h3 id="Query-注解方式查询"><a href="#Query-注解方式查询" class="headerlink" title="@Query 注解方式查询"></a>@Query 注解方式查询</h3><p>注解 <code>@Query</code> 允许在方法上使用 JPQL。</p>
<p>其中操作针对的是对象名和对象属性名，而非数据库中的表名和字段名。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;select u form User u where u.name=?1 and u.depantment.id=?2&quot;)</span>;</span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">findUser</span><span class="params">(String name, Integer departmentId)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;form User u where u.name=?1 and u.depantment.id=?2&quot;)</span>;</span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">findUser</span><span class="params">(String name, Integer departmentId)</span>;</span><br></pre></td></tr></table></figure>

<p>如果使用 SQL 而不是 JPSQL，可以使用 <code>nativeQuery</code> 属性，设置为 true。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(value=&quot;select * from user where name=?1 and department_id=?2&quot;, nativeQuery=true)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">nativeQuery</span><span class="params">(String name, Integer departmentId)</span>;</span><br></pre></td></tr></table></figure>

<p>无论 JPQL，还是 SQL，都支持”命名参数”：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(value=&quot;select * from user where name=:name and department_id=:departmentId&quot;, nativeQuery=true)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">nativeQuery2</span><span class="params">(String name, Integer departmentId)</span>;</span><br></pre></td></tr></table></figure>

<p>如果 SQL 活着 JPQL 查询结果集并非 Entity，可以用 <code>Object[]</code> 数组代替，比如分组统计每个部分的用户数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(value=&quot;select department_id,count(*) from user group by department_id&quot;, nativeQuery=true)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Object[]&gt; queryUserCount()</span><br></pre></td></tr></table></figure>

<p>这条查询将返回数组，对象类型依赖于查询结果，被示例中，返回的是 <code>String</code> 和 <code>BigInteger</code> 类型</p>
<p>查询时可以使用 <code>Pageable</code> 和 <code>Sort</code> 来完成翻页和排序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;select u from User u where department.id=?1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Page&lt;User&gt; <span class="title function_">QueryUsers</span><span class="params">(Integer departmentId, Pageable page)</span>;</span><br></pre></td></tr></table></figure>

<p><code>@Query</code> 还允许 SQL 更新、删除语句，此时必须搭配 <code>@Modifying</code> 使用，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Query(&quot;update User u set u.name= ?1 where u.id= ?2&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateName</span><span class="params">(String name, Integer id)</span>;</span><br></pre></td></tr></table></figure>

<h3 id="动态-SQL-方式查询"><a href="#动态-SQL-方式查询" class="headerlink" title="动态 SQL 方式查询"></a>动态 SQL 方式查询</h3><p>可参考：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904160807092237">SpringDataJpa 中的复杂查询和动态查询，多表查询</a></p>
<h3 id="Example-方式查询"><a href="#Example-方式查询" class="headerlink" title="Example 方式查询"></a>Example 方式查询</h3><p>允许根据实体创建一个 Example 对象，Spring Data 通过 Example 对象来构造 JPQL。但是使用不灵活条件是 AND,不能使用 or，时间的大于小于，between 等。</p>
<p>继承 <code>JpaRepository</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;S <span class="keyword">extends</span> <span class="title class_">T</span>&gt; List&lt;S&gt; <span class="title function_">findAll</span><span class="params">(Example&lt;S&gt; var1)</span>;</span><br><span class="line">&lt;S <span class="keyword">extends</span> <span class="title class_">T</span>&gt; List&lt;S&gt; <span class="title function_">findAll</span><span class="params">(Example&lt;S&gt; var1, Sort var2)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getByExample</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="type">Department</span> <span class="variable">dept</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Department</span>();</span><br><span class="line">    dept.setId(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setName(name);</span><br><span class="line">    user.setDepartment(dept);</span><br><span class="line">    Example&lt;User&gt; example = Example.of(user);</span><br><span class="line">    List&lt;User&gt; list = userDao.findAll(example);</span><br><span class="line">    <span class="keyword">return</span> list</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码首先创建了 User 对象，设置 查询条件，名称为参数 name，部门 id 为 1，通过 <code>Example.of</code> 构造了此查询。</p>
<p>大部分查询并非完全匹配查询，ExampleMatcher 提供了更多的条件指定.比如以 xxx 开头的所有用户，则可以使用以下代码构造</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExampleMatcher</span> <span class="variable">matcher</span> <span class="operator">=</span> ExampleMatcher.matching().withMatcher(<span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">    GenericPropertyMatchers.startsWith().ignoreCase());</span><br><span class="line">Example&lt;User&gt; example = Example.of(user, matcher);</span><br></pre></td></tr></table></figure>

<h3 id="排序-Sort"><a href="#排序-Sort" class="headerlink" title="排序 Sort"></a>排序 Sort</h3><p>Sort 对象用来指定排序，最简单的 Sort 对象构造可以传入一个属性名列表（不是数据库列名，是属性名）。默认采用升序排序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Sort</span> <span class="variable">sort</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sort</span>(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"><span class="comment">//Sort sort = new Sort(Direction.DESC, &quot;id&quot;);</span></span><br><span class="line"><span class="keyword">return</span> userDao.findAll(sort);</span><br></pre></td></tr></table></figure>

<p>Hibernate 根据 Sort 构造了排序条件，Sort(“id”) 表示按照 id 采用默认 升序进行排序</p>
<p>其他 Sort 的构造方法还包括以下主要的一些：</p>
<ul>
<li><code>public Sort(String... properties)</code>，按照指定的属性列表升序排序。</li>
<li><code>public Sort(Sort.Direction direction, String... properties)</code>，按照指定属性列表排序，排序由 direction 指定，direction 是一个枚举类型，有 <code>Direction.ASC</code> 和 <code>Direction.DESC</code>。</li>
<li><code>public Sort(Sort.Order... orders)</code>，可以通过 Order 静态方法来创建<ul>
<li><code>public static Sort.Order asc(String property)</code></li>
<li><code>public static Sort.Order desc(String property)</code></li>
</ul>
</li>
</ul>
<h3 id="分页-Page-和-Pageable"><a href="#分页-Page-和-Pageable" class="headerlink" title="分页 Page 和 Pageable"></a>分页 Page 和 Pageable</h3><p>Pageable 接口用于构造翻页查询，PageRequest 是其实现类，可以通过提供的工厂方法创建 PageRequest：</p>
<p>注意我这边使用的是 sring boot 2.0.2 ，jpa 版本是 2.0.8，新版本与之前版本的操作方法有所不同。</p>
<ul>
<li><p><code>public static PageRequest of(int page, int size)</code></p>
</li>
<li><p><code>public static PageRequest of(int page, int size, Sort sort)</code> - 也可以在 PageRequest 中加入排序</p>
</li>
<li><p><code>public static PageRequest of(int page, int size, Direction direction, String... properties)</code>，或者自定义排序规则</p>
</li>
</ul>
<p>page 是从 0 开始，表示查询页，size 指每页的期望行数。</p>
<p>Spring Data 翻页查询总是返回 Page 对象，Page 对象提供了以下常用的方法</p>
<ul>
<li><code>int getTotalPages();</code>，总的页数</li>
<li><code>long getTotalElements();</code> - 返回总数</li>
<li><code>List&lt;T&gt; getContent();</code> - 返回此次查询的结果集</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/">https://dunwu.github.io</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://coder-xuyong.github.io">coder-xuyong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://coder-xuyong.github.io/posts/b7d42c6b">https://coder-xuyong.github.io/posts/b7d42c6b</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://coder-xuyong.github.io" target="_blank">coder-xuyong</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Spring/">Spring</a><a class="post-meta__tags" href="/tags/%E6%A1%86%E6%9E%B6/">框架</a><a class="post-meta__tags" href="/tags/SpringBoot/">SpringBoot</a><a class="post-meta__tags" href="/tags/JPA/">JPA</a></div><div class="post-share"><div class="social-share" data-image="https://prod-alicdn-community.kurobbs.com/forum/86e33bf60c4d48499faa119f83e96fa120250619.jpg?x-oss-process=image%2Fformat%2Cwebp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/32d96a2b" title="Java并发简介"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/5803ca9faed74b0080a1156e0ef93aae20250529.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Java并发简介</div></div><div class="info-2"><div class="info-item-1">并发概念进程和线程 进程： 可以视为程序的一个实例。  线程： 线程作为最小调度单位，进程作为资源分配的最小单位。  一个进程之内可以分为一到多个线程。  一个线是一个指令流，将指令流中的一条条指令以一定的顺序交给 CPU 执行  Java 中，线程作为最小调度单位，进程作为资源分配的最小单位。 在 windows 中进程是不活动的，只是作为线程的容器。   进程和线程的差异：  一个程序至少有一个进程，一个进程至少有一个线程。 线程比进程划分更细，所以执行开销更小，并发性更高 进程是一个实体，拥有独立的资源；而同一个进程中的资源是多个线程共享的。  并行与并发单核 cpu 下，线程实际还是串行执行的。操作系统中有一个组件叫做任务调度器，将 cpu 的时间片（windows下时间片最小约为 15 毫秒）分给不同的程序使用，只是由于 cpu 在线程间（时间片很短）的切换非常快，人类感觉是 同时运行的 。总结为一句话就是： 微观串行，宏观并行 ，一般会将这种 线程轮流使用 CPU 的做法称为并发， concurrent    cpu 时间片1 时间片2 时间片3 时间片4    co...</div></div></div></a><a class="pagination-related" href="/pages/128c54/" title="Spring 之事务"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/43b6840836b84793980f93d5e9d786ce20250730.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Spring 之事务</div></div><div class="info-2"><div class="info-item-1">理解事务在软件开发领域，全有或全无的操作被称为事务（transaction）。事务允许你将几个操作组合成一个要么全部发生要么全部不发生的工作单元。传统上 Java EE 开发对事务管理有两种选择：全局事务或本地事务，两者都有很大的局限性。 事务应该具有 4 个属性：原子性、一致性、隔离性、持久性。这四个属性通常称为 ACID。 快速入门创建 Service 接口实现类 TransactionServiceA 类，在 methodA() 方法中先往 tablea 表格插入一条数据，随后会调用 TransactionServiceB 服务的 methodB() 方法往 tableb 表格中插入一条数据。 123456789101112131415@Servicepublic class TransactionServiceA &#123;    @Autowired    private TableService tableService;    @Autowired    private TransactionServiceB transactionServiceB;    pub...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/da3ef66a" title="SpringBoot 知识清单"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/20260fdbdfe74ca9842680f7ff9039c220250829.jpg?x-oss-process=image%2Fformat%2Cwebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-15</div><div class="info-item-2">SpringBoot 知识清单</div></div><div class="info-2"><div class="info-item-1">SpringBoot 知识图谱  预警：本文非常长，建议先 mark 后看，也许是最后一次写这么长的文章 说明：前面有 4 个小节关于 Spring 的基础知识，分别是：IOC 容器、JavaConfig、事件监听、SpringFactoriesLoader 详解，它们占据了本文的大部分内容，虽然它们之间可能没有太多的联系，但这些知识对于理解 Spring Boot 的核心原理至关重要，如果你对 Spring 框架烂熟于心，完全可以跳过这 4 个小节。正是因为这个系列的文章是由这些看似不相关的知识点组成，因此取名知识清单。   在过去两三年的 Spring 生态圈，最让人兴奋的莫过于 Spring Boot 框架。或许从命名上就能看出这个框架的设计初衷：快速的启动 Spring 应用。因而 Spring Boot 应用本质上就是一个基于 Spring 框架的应用，它是 Spring 对“约定优先于配置”理念的最佳实践产物，它能够帮助开发者更快速高效地构建基于 Spring 生态圈的应用。 那 Spring Boot 有何魔法？自动配置、起步依赖、Actuator、命令行界面(CL...</div></div></div></a><a class="pagination-related" href="/posts/1465b468" title="SpringBoot 之快速入门"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/f59dff6fb93d4904b442d315738e6a6420250507.jpg?x-oss-process=image%2Fformat%2Cwebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-13</div><div class="info-item-2">SpringBoot 之快速入门</div></div><div class="info-2"><div class="info-item-1">Spring Boot 简介Spring Boot 可以让使用者非常方便的创建 Spring 应用。 Spring Boot 的目标是：  为所有 Spring 开发者提供更快且可广泛访问的入门体验。 开箱即用 提供一系列通用的非功能特性（例如嵌入式服务、安全、指标、健康检查和外部化配置） 完全不需要代码生成，也不需要 XML 配置。  Spring Boot 系统要求Spring Boot 的构建工具要求：    Build Tool Version    Maven 3.5+   Gradle 6.8.x, 6.9.x, and 7.x   Spring Boot 支持的 Servlet 容器：    Name Servlet Version    Tomcat 9.0 4.0   Jetty 9.4 3.1   Jetty 10.0 4.0   Undertow 2.0 4.0   部署第一个 Spring Boot 项目 本节介绍如何开发一个小的“Hello World!” web 应用示例，来展示 Spring Boot 的一些关键功能。我们使用 Maven 来构建这个...</div></div></div></a><a class="pagination-related" href="/posts/32907b42" title="SpringBoot 之属性加载详解"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/6edb712c4a9a46bb843646404a0ff2db20250904.jpg?x-oss-process=image%2Fformat%2Cwebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-13</div><div class="info-item-2">SpringBoot 之属性加载详解</div></div><div class="info-2"><div class="info-item-1">加载 property 顺序Spring Boot 加载 property 顺序如下：  Devtools 全局配置 (当 devtools 被激活 ~/.spring-boot-devtools.properties). 测试环境中的 @TestPropertySource 注解配置 测试环境中的属性 properties：@SpringBootTest 和 测试注解. 命令行参数 SPRING_APPLICATION_JSON 属性 ServletConfig 初始化参数 ServletContext 初始化参数 JNDI attributes from 通过 java:comp/env 配置的 JNDI 属性 Java 系统属性 (System.getProperties()) 操作系统环境比那里 RandomValuePropertySource 加载 random.* 形式的属性 jar 包外的 application-&#123;profile&#125;.properties 或 application-&#123;profile&#125;.yml 配置 jar ...</div></div></div></a><a class="pagination-related" href="/posts/ebd5b707" title="SpringBoot 之 Profile"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/dbc6de3bf3ec4db59f8ca4288cfa3e3c20250507.jpg?x-oss-process=image%2Fformat%2Cwebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-13</div><div class="info-item-2">SpringBoot 之 Profile</div></div><div class="info-2"><div class="info-item-1">SpringBoot 之 Profile 一个应用为了在不同的环境下工作，常常会有不同的配置，代码逻辑处理。Spring Boot 对此提供了简便的支持。 关键词： @Profile、spring.profiles.active  区分环境的配置properties 配置假设，一个应用的工作环境有：dev、test、prod 那么，我们可以添加 4 个配置文件：  applcation.properties - 公共配置 application-dev.properties - 开发环境配置 application-test.properties - 测试环境配置 application-prod.properties - 生产环境配置  在 applcation.properties 文件中可以通过以下配置来激活 profile： 1spring.profiles.active = test  yml 配置与 properties 文件类似，我们也可以添加 4 个配置文件：  applcation.yml - 公共配置 application-dev.yml - 开发环境配置 ...</div></div></div></a><a class="pagination-related" href="/pages/128c54/" title="Spring 之事务"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/43b6840836b84793980f93d5e9d786ce20250730.jpg?x-oss-process=image%2Fformat%2Cwebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-14</div><div class="info-item-2">Spring 之事务</div></div><div class="info-2"><div class="info-item-1">理解事务在软件开发领域，全有或全无的操作被称为事务（transaction）。事务允许你将几个操作组合成一个要么全部发生要么全部不发生的工作单元。传统上 Java EE 开发对事务管理有两种选择：全局事务或本地事务，两者都有很大的局限性。 事务应该具有 4 个属性：原子性、一致性、隔离性、持久性。这四个属性通常称为 ACID。 快速入门创建 Service 接口实现类 TransactionServiceA 类，在 methodA() 方法中先往 tablea 表格插入一条数据，随后会调用 TransactionServiceB 服务的 methodB() 方法往 tableb 表格中插入一条数据。 123456789101112131415@Servicepublic class TransactionServiceA &#123;    @Autowired    private TableService tableService;    @Autowired    private TransactionServiceB transactionServiceB;    pub...</div></div></div></a><a class="pagination-related" href="/pages/88219e/" title="Spring 集成 Mybatis"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/dcdad1b7aa454b97b412899068f94aa620250313.jpg?x-oss-process=image%2Fformat%2Cwebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-05-09</div><div class="info-item-2">Spring 集成 Mybatis</div></div><div class="info-2"><div class="info-item-1">Spring 集成 MybatisMybatis 官网 是一款持久层框架，它支持定制化 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以使用简单的 XML 或注解来配置和映射原生类型、接口和 Java 的 POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。 快速入门要使用 MyBatis， 只需将 mybatis-x.x.x.jar 文件置于类路径（classpath）中即可。 如果使用 Maven 来构建项目，则需将下面的依赖代码置于 pom.xml 文件中： 12345&lt;dependency&gt;  &lt;groupId&gt;org.mybatis&lt;/groupId&gt;  &lt;artifactId&gt;mybatis&lt;/artifactId&gt;  &lt;version&gt;x.x.x&lt;/version&gt;&lt;/dependency&gt;  从 XML 中构建 SqlSessionFactor...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/medias/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">coder-xuyong</div><div class="author-info-description">生如牛马不得闲</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">100</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">97</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">45</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/coder-xuyong"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-%E4%B9%8B-JPA"><span class="toc-number">1.</span> <span class="toc-text">Spring 之 JPA</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.1.</span> <span class="toc-text">快速入门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8-JPA-%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.2.</span> <span class="toc-text">常用 JPA 注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93"><span class="toc-number">1.2.1.</span> <span class="toc-text">实体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Entity"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">@Entity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MappedSuperclass"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">@MappedSuperclass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Table"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">@Table</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">主键</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Id"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">@Id</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GeneratedValue"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">@GeneratedValue</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84"><span class="toc-number">1.2.3.</span> <span class="toc-text">映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Column"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">@Column</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB"><span class="toc-number">1.2.4.</span> <span class="toc-text">关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OneToOne"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">@OneToOne</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OneToMany"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">@OneToMany</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.</span> <span class="toc-text">查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%90%8D%E5%AD%97%E6%96%B9%E5%BC%8F%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.1.</span> <span class="toc-text">方法名字方式查询方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Query-%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.2.</span> <span class="toc-text">@Query 注解方式查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81-SQL-%E6%96%B9%E5%BC%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.3.</span> <span class="toc-text">动态 SQL 方式查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Example-%E6%96%B9%E5%BC%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.4.</span> <span class="toc-text">Example 方式查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F-Sort"><span class="toc-number">1.3.5.</span> <span class="toc-text">排序 Sort</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5-Page-%E5%92%8C-Pageable"><span class="toc-number">1.3.6.</span> <span class="toc-text">分页 Page 和 Pageable</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">1.4.</span> <span class="toc-text">参考</span></a></li></ol></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>Sring数据源</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/b7d42c6b" title="Spring 之 JPA"><img src="https://prod-alicdn-community.kurobbs.com/forum/86e33bf60c4d48499faa119f83e96fa120250619.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring 之 JPA"></a><div class="content"><a class="title" href="/posts/b7d42c6b" title="Spring 之 JPA">Spring 之 JPA</a><time datetime="2025-10-14T02:33:55.000Z" title="发表于 2025-10-14 10:33:55">2025-10-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/pages/128c54/" title="Spring 之事务"><img src="https://prod-alicdn-community.kurobbs.com/forum/43b6840836b84793980f93d5e9d786ce20250730.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring 之事务"></a><div class="content"><a class="title" href="/pages/128c54/" title="Spring 之事务">Spring 之事务</a><time datetime="2025-10-13T23:46:49.000Z" title="发表于 2025-10-14 07:46:49">2025-10-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d702cb34" title="Spring 之 JDBC"><img src="https://prod-alicdn-community.kurobbs.com/forum/7f933184dd4747a0bb326ff1bca1eda720250730.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring 之 JDBC"></a><div class="content"><a class="title" href="/posts/d702cb34" title="Spring 之 JDBC">Spring 之 JDBC</a><time datetime="2025-07-29T06:33:55.000Z" title="发表于 2025-07-29 14:33:55">2025-07-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/57f1fe16" title="Spring 之数据源"><img src="https://prod-alicdn-community.kurobbs.com/forum/f59dff6fb93d4904b442d315738e6a6420250507.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring 之数据源"></a><div class="content"><a class="title" href="/posts/57f1fe16" title="Spring 之数据源">Spring 之数据源</a><time datetime="2025-07-29T01:27:55.000Z" title="发表于 2025-07-29 09:27:55">2025-07-29</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/c16f2ba9" title="ForkJoin框架"><img src="https://prod-alicdn-community.kurobbs.com/forum/7f933184dd4747a0bb326ff1bca1eda720250730.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ForkJoin框架"/></a><div class="content"><a class="title" href="/posts/c16f2ba9" title="ForkJoin框架">ForkJoin框架</a><time datetime="2025-10-18T07:27:46.000Z" title="发表于 2025-10-18 15:27:46">2025-10-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/91e798bc" title="Java内存模型"><img src="https://prod-alicdn-community.kurobbs.com/forum/5803ca9faed74b0080a1156e0ef93aae20250529.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java内存模型"/></a><div class="content"><a class="title" href="/posts/91e798bc" title="Java内存模型">Java内存模型</a><time datetime="2025-10-18T02:43:11.000Z" title="发表于 2025-10-18 10:43:11">2025-10-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/19b32c42" title="Java并发工具类"><img src="https://prod-alicdn-community.kurobbs.com/forum/dcdad1b7aa454b97b412899068f94aa620250313.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java并发工具类"/></a><div class="content"><a class="title" href="/posts/19b32c42" title="Java并发工具类">Java并发工具类</a><time datetime="2025-10-17T15:52:25.000Z" title="发表于 2025-10-17 23:52:25">2025-10-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://prod-alicdn-community.kurobbs.com/forum/86e33bf60c4d48499faa119f83e96fa120250619.jpg?x-oss-process=image%2Fformat%2Cwebp);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By coder-xuyong</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div><div class="footer_custom_text">Hi, welcome to coder-xuyong's <a href="https://coder-xuyong.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><!-- butterfly右下角悬浮菜单栏 百分比--><span id="percent">0</span></button><!-- butterfly右下角悬浮菜单栏 直达底部--><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  const initGitalk = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyGitalk = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const gitalk = new Gitalk({
      clientID: 'Ov23li4gzANXxmx9072g',
      clientSecret: 'b4da9f4490b2864bfdee5df73655329a642c6112',
      repo: 'coder-xuyong.github.io',
      owner: 'coder-xuyong',
      admin: ['coder-xuyong'],
      updateCountCallback: commentCount,
      ...option,
      id: isShuoshuo ? path : (option && option.id) || '45334e8b05833d967c01393e38beed0a'
    })

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async(el, path) => {
    if (typeof Gitalk === 'function') initGitalk(el, path)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js')
      initGitalk(el, path)
    }
  }

  if (isShuoshuo) {
    'Gitalk' === 'Gitalk'
      ? window.shuoshuoComment = { loadComment: loadGitalk }
      : window.loadOtherComment = loadGitalk
    return
  }

  if ('Gitalk' === 'Gitalk' || !true) {
    if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script src="/self/custom.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="https://cn.vercount.one/js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="search key word" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>