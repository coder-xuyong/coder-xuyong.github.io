<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Spring 校验 | coder-xuyong</title><meta name="author" content="coder-xuyong"><meta name="copyright" content="coder-xuyong"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Spring 校验Java API 规范(JSR303)定义了Bean校验的标准validation-api，但没有提供实现。hibernate validation是对这个规范的实现，并增加了校验注解如@Email、@Length等。Spring Validation是对hibernate validation的二次封装，用于支持spring mvc参数自动校验。 快速入门引入依赖如果 spri">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring 校验">
<meta property="og:url" content="https://coder-xuyong.github.io/posts/c6c8fb67">
<meta property="og:site_name" content="coder-xuyong">
<meta property="og:description" content="Spring 校验Java API 规范(JSR303)定义了Bean校验的标准validation-api，但没有提供实现。hibernate validation是对这个规范的实现，并增加了校验注解如@Email、@Length等。Spring Validation是对hibernate validation的二次封装，用于支持spring mvc参数自动校验。 快速入门引入依赖如果 spri">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://prod-alicdn-community.kurobbs.com/forum/dcdad1b7aa454b97b412899068f94aa620250313.jpg?x-oss-process=image%2Fformat%2Cwebp">
<meta property="article:published_time" content="2025-10-09T14:58:41.000Z">
<meta property="article:modified_time" content="2025-10-25T09:52:26.943Z">
<meta property="article:author" content="coder-xuyong">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="框架">
<meta property="article:tag" content="转载">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://prod-alicdn-community.kurobbs.com/forum/dcdad1b7aa454b97b412899068f94aa620250313.jpg?x-oss-process=image%2Fformat%2Cwebp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Spring 校验",
  "url": "https://coder-xuyong.github.io/posts/c6c8fb67",
  "image": "https://prod-alicdn-community.kurobbs.com/forum/dcdad1b7aa454b97b412899068f94aa620250313.jpg?x-oss-process=image%2Fformat%2Cwebp",
  "datePublished": "2025-10-09T14:58:41.000Z",
  "dateModified": "2025-10-25T09:52:26.943Z",
  "author": [
    {
      "@type": "Person",
      "name": "coder-xuyong",
      "url": "https://coder-xuyong.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/medias/img/logo.png"><link rel="canonical" href="https://coder-xuyong.github.io/posts/c6c8fb67"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: coder-xuyong","link":"链接: ","source":"来源: coder-xuyong","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring 校验',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/self/custom.css"><link rel="stylesheet" href="/self/progress_bar.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/self/progress_bar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-color: #fafafa;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/medias/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">100</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">97</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">45</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-bars-progress"></i><span> 合集</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/java/"><i class="fa-fw fa-brands fa-java"></i><span> Java</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://prod-alicdn-community.kurobbs.com/forum/dcdad1b7aa454b97b412899068f94aa620250313.jpg?x-oss-process=image%2Fformat%2Cwebp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/medias/img/logo.png" alt="Logo"><span class="site-name">coder-xuyong</span></a><a class="nav-page-title" href="/"><span class="site-name">Spring 校验</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-bars-progress"></i><span> 合集</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/java/"><i class="fa-fw fa-brands fa-java"></i><span> Java</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Spring 校验<a class="post-edit-link" href="https://github.com/coder-xuyong/coder-xuyong.github.io/edit/main/source/_posts/01.Java/03.Frame/01.Spring/01.Spring核心/09.Spring校验.md" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-09T14:58:41.000Z" title="发表于 2025-10-09 22:58:41">2025-10-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-25T09:52:26.943Z" title="更新于 2025-10-25 17:52:26">2025-10-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/1-Java/">1.Java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/1-Java/3-Frame/">3.Frame</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/1-Java/3-Frame/1-Spring/">1.Spring</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/1-Java/3-Frame/1-Spring/1-Spring%E6%A0%B8%E5%BF%83/">1.Spring核心</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;已经过了&quot;,&quot;messageNext&quot;:&quot;天自上次更新，文章内容可能已过时。&quot;,&quot;postUpdate&quot;:&quot;2025-10-25 17:52:26&quot;}" hidden></div><h1 id="Spring-校验"><a href="#Spring-校验" class="headerlink" title="Spring 校验"></a>Spring 校验</h1><p>Java API 规范(<code>JSR303</code>)定义了<code>Bean</code>校验的标准<code>validation-api</code>，但没有提供实现。<code>hibernate validation</code>是对这个规范的实现，并增加了校验注解如<code>@Email</code>、<code>@Length</code>等。<code>Spring Validation</code>是对<code>hibernate validation</code>的二次封装，用于支持<code>spring mvc</code>参数自动校验。</p>
<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><p>如果 spring-boot 版本小于 2.3.x，spring-boot-starter-web 会自动传入 hibernate-validator 依赖。如果 spring-boot 版本大于 2.3.x，则需要手动引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.2.5.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对于 web 服务来说，为防止非法参数对业务造成影响，在 Controller 层一定要做参数校验的！大部分情况下，请求参数分为如下两种形式：</p>
<ul>
<li>POST、PUT 请求，使用 requestBody 传递参数；</li>
<li>GET 请求，使用 requestParam&#x2F;PathVariable 传递参数。</li>
</ul>
<p>实际上，不管是 requestBody 参数校验还是方法级别的校验，最终都是调用 Hibernate Validator 执行校验，Spring Validation 只是做了一层封装。</p>
<h3 id="校验示例"><a href="#校验示例" class="headerlink" title="校验示例"></a>校验示例</h3><p>（1）在实体上标记校验注解</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="title">implements</span> <span class="title">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Long</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank</span></span><br><span class="line">    <span class="meta">@Size(min = 2, max = 10)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Min(value = 1)</span></span><br><span class="line">    <span class="meta">@Max(value = 100)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）在方法参数上声明校验注解</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Slf4j</span></span><br><span class="line"><span class="variable">@Validated</span></span><br><span class="line"><span class="variable">@RestController</span></span><br><span class="line"><span class="variable">@RequestMapping</span>(<span class="string">&quot;validate1&quot;</span>)</span><br><span class="line">public class ValidatorController &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;@link RequestBody&#125; 参数校验</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable">@PostMapping</span>(value = <span class="string">&quot;save&quot;</span>)</span><br><span class="line">    public DataResult&lt;Boolean&gt; <span class="built_in">save</span>(<span class="variable">@Valid</span> <span class="variable">@RequestBody</span> User entity) &#123;</span><br><span class="line">        <span class="selector-tag">log</span><span class="selector-class">.info</span>(<span class="string">&quot;保存一条记录：&#123;&#125;&quot;</span>, JSONUtil.<span class="built_in">toJsonStr</span>(entity));</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">DataResult</span><span class="selector-class">.ok</span>(true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;@link RequestParam&#125; 参数校验</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @<span class="selector-tag">GetMapping</span>(value = <span class="string">&quot;queryByName&quot;</span>)</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">DataResult</span>&lt;<span class="selector-tag">User</span>&gt; <span class="selector-tag">queryByName</span>(</span><br><span class="line">        <span class="variable">@RequestParam</span>(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">        <span class="variable">@NotBlank</span></span><br><span class="line">        <span class="variable">@Size</span>(min = <span class="number">2</span>, max = <span class="number">10</span>)</span><br><span class="line">        String name</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="selector-tag">User</span> <span class="selector-tag">user</span> = <span class="selector-tag">new</span> <span class="selector-tag">User</span>(<span class="number">1</span>L, name, <span class="number">18</span>);</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">DataResult</span><span class="selector-class">.ok</span>(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;@link PathVariable&#125; 参数校验</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @<span class="selector-tag">GetMapping</span>(value = <span class="string">&quot;detail/&#123;id&#125;&quot;</span>)</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">DataResult</span>&lt;<span class="selector-tag">User</span>&gt; <span class="selector-tag">detail</span>(<span class="variable">@PathVariable</span>(<span class="string">&quot;id&quot;</span>) <span class="variable">@Min</span>(<span class="number">1</span>L) Long id) &#123;</span><br><span class="line">        <span class="selector-tag">User</span> <span class="selector-tag">user</span> = <span class="selector-tag">new</span> <span class="selector-tag">User</span>(id, <span class="string">&quot;李四&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">DataResult</span><span class="selector-class">.ok</span>(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）如果请求参数不满足校验规则，则会抛出 <code>ConstraintViolationException</code> 或 <code>MethodArgumentNotValidException</code> 异常。</p>
<h3 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h3><p>在实际项目开发中，通常会用统一异常处理来返回一个更友好的提示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理所有不可知的异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.OK)</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Throwable.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">handleException</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;未知异常&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(ResultStatus.HTTP_SERVER_ERROR.getCode(), e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 统一处理请求参数校验异常(普通传参)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e ConstraintViolationException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> DataResult&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(&#123; ConstraintViolationException.class &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">handleConstraintViolationException</span><span class="params">(<span class="keyword">final</span> ConstraintViolationException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;ConstraintViolationException&quot;</span>, e);</span><br><span class="line">        List&lt;String&gt; errors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (ConstraintViolation&lt;?&gt; violation : e.getConstraintViolations()) &#123;</span><br><span class="line">            <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> violation.getPropertyPath();</span><br><span class="line">            List&lt;String&gt; pathArr = StrUtil.split(path.toString(), <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">            errors.add(pathArr.get(<span class="number">0</span>) + <span class="string">&quot; &quot;</span> + violation.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(ResultStatus.REQUEST_ERROR.getCode(), CollectionUtil.join(errors, <span class="string">&quot;,&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理参数校验异常</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e MethodArgumentNotValidException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> DataResult&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(&#123; MethodArgumentNotValidException.class &#125;)</span></span><br><span class="line">    <span class="keyword">private</span> Result <span class="title function_">handleMethodArgumentNotValidException</span><span class="params">(<span class="keyword">final</span> MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;MethodArgumentNotValidException&quot;</span>, e);</span><br><span class="line">        List&lt;String&gt; errors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (ObjectError error : e.getBindingResult().getAllErrors()) &#123;</span><br><span class="line">            errors.add(((FieldError) error).getField() + <span class="string">&quot; &quot;</span> + error.getDefaultMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(ResultStatus.REQUEST_ERROR.getCode(), CollectionUtil.join(errors, <span class="string">&quot;,&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="进阶使用"><a href="#进阶使用" class="headerlink" title="进阶使用"></a>进阶使用</h2><h3 id="分组校验"><a href="#分组校验" class="headerlink" title="分组校验"></a>分组校验</h3><p>在实际项目中，可能多个方法需要使用同一个 DTO 类来接收参数，而不同方法的校验规则很可能是不一样的。这个时候，简单地在 DTO 类的字段上加约束注解无法解决这个问题。因此，spring-validation 支持了分组校验的功能，专门用来解决这类问题。</p>
<p>（1）定义分组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123; ElementType.FIELD, ElementType.PARAMETER &#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AddCheck &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(&#123; ElementType.FIELD, ElementType.PARAMETER &#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EditCheck &#123; &#125;</span><br></pre></td></tr></table></figure>

<p>（2）在实体上标记校验注解</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Data</span></span><br><span class="line">public class User2 &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@NotNull</span>(groups = EditCheck.class)</span><br><span class="line">    private Long id;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@NotNull</span>(groups = &#123; AddCheck.class, EditCheck.class &#125;)</span><br><span class="line">    <span class="variable">@Size</span>(min = <span class="number">2</span>, max = <span class="number">10</span>, groups = &#123; AddCheck.class, EditCheck.class &#125;)</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@IsMobile</span>(message = <span class="string">&quot;不是有效手机号&quot;</span>, groups = &#123; AddCheck.class, EditCheck.class &#125;)</span><br><span class="line">    private String mobile;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）在方法上根据不同场景进行校验分组</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Slf4j</span></span><br><span class="line"><span class="variable">@Validated</span></span><br><span class="line"><span class="variable">@RestController</span></span><br><span class="line"><span class="variable">@RequestMapping</span>(<span class="string">&quot;validate2&quot;</span>)</span><br><span class="line">public class ValidatorController2 &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;@link RequestBody&#125; 参数校验</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable">@PostMapping</span>(value = <span class="string">&quot;add&quot;</span>)</span><br><span class="line">    public DataResult&lt;Boolean&gt; <span class="built_in">add</span>(<span class="variable">@Validated</span>(AddCheck.class) <span class="variable">@RequestBody</span> User2 entity) &#123;</span><br><span class="line">        <span class="selector-tag">log</span><span class="selector-class">.info</span>(<span class="string">&quot;添加一条记录：&#123;&#125;&quot;</span>, JSONUtil.<span class="built_in">toJsonStr</span>(entity));</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">DataResult</span><span class="selector-class">.ok</span>(true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;@link RequestBody&#125; 参数校验</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @<span class="selector-tag">PostMapping</span>(value = <span class="string">&quot;edit&quot;</span>)</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">DataResult</span>&lt;<span class="selector-tag">Boolean</span>&gt; <span class="selector-tag">edit</span>(<span class="variable">@Validated</span>(EditCheck.class) <span class="variable">@RequestBody</span> User2 entity) &#123;</span><br><span class="line">        <span class="selector-tag">log</span><span class="selector-class">.info</span>(<span class="string">&quot;编辑一条记录：&#123;&#125;&quot;</span>, JSONUtil.<span class="built_in">toJsonStr</span>(entity));</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">DataResult</span><span class="selector-class">.ok</span>(true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="嵌套校验"><a href="#嵌套校验" class="headerlink" title="嵌套校验"></a>嵌套校验</h3><p>前面的示例中，DTO 类里面的字段都是基本数据类型和 String 类型。但是实际场景中，有可能某个字段也是一个对象，这种情况先，可以使用嵌套校验。<br>post<br>比如，上面保存 User 信息的时候同时还带有 Job 信息。需要注意的是，此时 DTO 类的对应字段必须标记@Valid 注解。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Data</span></span><br><span class="line">public class UserDTO &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Min</span>(value = <span class="number">10000000000000000</span>L, groups = <span class="attribute">Update</span>.class)</span><br><span class="line">    private Long userId;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@NotNull</span>(groups = &#123;Save.class, <span class="attribute">Update</span>.class&#125;)</span><br><span class="line">    <span class="variable">@Length</span>(min = <span class="number">2</span>, max = <span class="number">10</span>, groups = &#123;Save.class, <span class="attribute">Update</span>.class&#125;)</span><br><span class="line">    private String userName;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@NotNull</span>(groups = &#123;Save.class, <span class="attribute">Update</span>.class&#125;)</span><br><span class="line">    <span class="variable">@Length</span>(min = <span class="number">6</span>, max = <span class="number">20</span>, groups = &#123;Save.class, <span class="attribute">Update</span>.class&#125;)</span><br><span class="line">    private String account;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@NotNull</span>(groups = &#123;Save.class, <span class="attribute">Update</span>.class&#125;)</span><br><span class="line">    <span class="variable">@Length</span>(min = <span class="number">6</span>, max = <span class="number">20</span>, groups = &#123;Save.class, <span class="attribute">Update</span>.class&#125;)</span><br><span class="line">    private String password;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@NotNull</span>(groups = &#123;Save.class, <span class="attribute">Update</span>.class&#125;)</span><br><span class="line">    <span class="variable">@Valid</span></span><br><span class="line">    private Job job;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Data</span></span><br><span class="line">    public static class Job &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">@Min</span>(value = <span class="number">1</span>, groups = <span class="attribute">Update</span>.class)</span><br><span class="line">        private Long jobId;</span><br><span class="line"></span><br><span class="line">        <span class="variable">@NotNull</span>(groups = &#123;Save.class, <span class="attribute">Update</span>.class&#125;)</span><br><span class="line">        <span class="variable">@Length</span>(min = <span class="number">2</span>, max = <span class="number">10</span>, groups = &#123;Save.class, <span class="attribute">Update</span>.class&#125;)</span><br><span class="line">        private String jobName;</span><br><span class="line"></span><br><span class="line">        <span class="variable">@NotNull</span>(groups = &#123;Save.class, <span class="attribute">Update</span>.class&#125;)</span><br><span class="line">        <span class="variable">@Length</span>(min = <span class="number">2</span>, max = <span class="number">10</span>, groups = &#123;Save.class, <span class="attribute">Update</span>.class&#125;)</span><br><span class="line">        private String position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存的时候校验分组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    public interface Save &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新的时候校验分组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    public interface Update &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>嵌套校验可以结合分组校验一起使用。还有就是嵌套集合校验会对集合里面的每一项都进行校验，例如<code>List&lt;Job&gt;</code>字段会对这个 list 里面的每一个 Job 对象都进行校验</p>
<h3 id="自定义校验注解"><a href="#自定义校验注解" class="headerlink" title="自定义校验注解"></a>自定义校验注解</h3><p>（1）自定义校验注解 <code>@IsMobile</code></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Target</span>(&#123; METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE &#125;)</span><br><span class="line"><span class="variable">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="variable">@Constraint</span>(validatedBy = MobileValidator.class)</span><br><span class="line">public <span class="variable">@interface</span> IsMobile &#123;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">String</span> <span class="selector-tag">message</span>();</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">Class</span>&lt;?&gt;<span class="selector-attr">[]</span> <span class="selector-tag">groups</span>() <span class="selector-tag">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">Class</span>&lt;? <span class="selector-tag">extends</span> <span class="selector-tag">Payload</span>&gt;<span class="selector-attr">[]</span> <span class="selector-tag">payload</span>() <span class="selector-tag">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）实现 <code>ConstraintValidator</code> 接口，编写 <code>@IsMobile</code> 校验注解的解析器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> io.github.dunwu.spring.core.validation.annotation.IsMobile;</span><br><span class="line"><span class="keyword">import</span> io.github.dunwu.tool.util.ValidatorUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.ConstraintValidator;</span><br><span class="line"><span class="keyword">import</span> javax.validation.ConstraintValidatorContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MobileValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;IsMobile, String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(IsMobile isMobile)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s, ConstraintValidatorContext constraintValidatorContext)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(s)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> ValidatorUtil.isMobile(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义校验"><a href="#自定义校验" class="headerlink" title="自定义校验"></a>自定义校验</h3><p>可以通过实现 <code>org.springframework.validation.Validator</code> 接口来自定义校验。</p>
<p>有以下要点</p>
<ul>
<li>实现 <code>supports</code> 方法</li>
<li>实现 <code>validate</code> 方法<ul>
<li>通过 <code>Errors</code> 对象收集错误<ul>
<li><code>ObjectError</code>：对象（Bean）错误：</li>
<li><code>FieldError</code>：对象（Bean）属性（Property）错误</li>
</ul>
</li>
<li>通过 <code>ObjectError</code> 和 <code>FieldError</code> 关联 <code>MessageSource</code> 实现获取最终的错误文案</li>
</ul>
</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">package</span> <span class="selector-tag">io</span><span class="selector-class">.github</span><span class="selector-class">.dunwu</span><span class="selector-class">.spring</span><span class="selector-class">.core</span><span class="selector-class">.validation</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">io</span><span class="selector-class">.github</span><span class="selector-class">.dunwu</span><span class="selector-class">.spring</span><span class="selector-class">.core</span><span class="selector-class">.validation</span><span class="selector-class">.annotation</span><span class="selector-class">.Valid</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">io</span><span class="selector-class">.github</span><span class="selector-class">.dunwu</span><span class="selector-class">.spring</span><span class="selector-class">.core</span><span class="selector-class">.validation</span><span class="selector-class">.config</span><span class="selector-class">.CustomValidatorConfig</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">io</span><span class="selector-class">.github</span><span class="selector-class">.dunwu</span><span class="selector-class">.spring</span><span class="selector-class">.core</span><span class="selector-class">.validation</span><span class="selector-class">.entity</span><span class="selector-class">.Person</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.stereotype</span><span class="selector-class">.Component</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.validation</span><span class="selector-class">.Errors</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.validation</span><span class="selector-class">.ValidationUtils</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.validation</span><span class="selector-class">.Validator</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.annotation</span><span class="selector-class">.Annotation</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Field</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">java</span><span class="selector-class">.util</span><span class="selector-class">.ArrayList</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">java</span><span class="selector-class">.util</span><span class="selector-class">.Collections</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">java</span><span class="selector-class">.util</span><span class="selector-class">.List</span>;</span><br><span class="line"></span><br><span class="line">@<span class="selector-tag">Component</span></span><br><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">class</span> <span class="selector-tag">CustomValidator</span> <span class="selector-tag">implements</span> <span class="selector-tag">Validator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">final</span> <span class="selector-tag">CustomValidatorConfig</span> <span class="selector-tag">validatorConfig</span>;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">CustomValidator</span>(CustomValidatorConfig validatorConfig) &#123;</span><br><span class="line">        <span class="selector-tag">this</span><span class="selector-class">.validatorConfig</span> = <span class="selector-tag">validatorConfig</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 本校验器只针对 Person 对象进行校验</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @<span class="selector-tag">Override</span></span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">boolean</span> <span class="selector-tag">supports</span>(Class&lt;?&gt; clazz) &#123;</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">Person</span><span class="selector-class">.class</span><span class="selector-class">.equals</span>(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="selector-tag">Override</span></span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">validate</span>(Object target, Errors errors) &#123;</span><br><span class="line">        <span class="selector-tag">ValidationUtils</span><span class="selector-class">.rejectIfEmpty</span>(errors, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;name.empty&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="selector-tag">List</span>&lt;<span class="selector-tag">Field</span>&gt; <span class="selector-tag">fields</span> = <span class="selector-tag">getFields</span>(target.<span class="built_in">getClass</span>());</span><br><span class="line">        <span class="selector-tag">for</span> (Field <span class="attribute">field </span>: fields) &#123;</span><br><span class="line">            <span class="selector-tag">Annotation</span><span class="selector-attr">[]</span> <span class="selector-tag">annotations</span> = <span class="selector-tag">field</span><span class="selector-class">.getAnnotations</span>();</span><br><span class="line">            <span class="selector-tag">for</span> (Annotation <span class="attribute">annotation </span>: annotations) &#123;</span><br><span class="line">                <span class="selector-tag">if</span> (annotation.<span class="built_in">annotationType</span>().<span class="built_in">getAnnotation</span>(Valid.class) != null) &#123;</span><br><span class="line">                    <span class="selector-tag">try</span> &#123;</span><br><span class="line">                        <span class="selector-tag">ValidatorRule</span> <span class="selector-tag">validatorRule</span> = <span class="selector-tag">validatorConfig</span><span class="selector-class">.findRule</span>(annotation);</span><br><span class="line">                        <span class="selector-tag">if</span> (validatorRule != null) &#123;</span><br><span class="line">                            <span class="selector-tag">validatorRule</span><span class="selector-class">.valid</span>(annotation, target, field, errors);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="selector-tag">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="selector-tag">e</span><span class="selector-class">.printStackTrace</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">List</span>&lt;<span class="selector-tag">Field</span>&gt; <span class="selector-tag">getFields</span>(Class&lt;?&gt; clazz) &#123;</span><br><span class="line">        <span class="comment">// 声明Field数组</span></span><br><span class="line">        <span class="selector-tag">List</span>&lt;<span class="selector-tag">Field</span>&gt; <span class="selector-tag">fields</span> = <span class="selector-tag">new</span> <span class="selector-tag">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 如果class类型不为空</span></span><br><span class="line">        <span class="selector-tag">while</span> (clazz != null) &#123;</span><br><span class="line">            <span class="comment">// 添加属性到属性数组</span></span><br><span class="line">            <span class="selector-tag">Collections</span><span class="selector-class">.addAll</span>(fields, clazz.<span class="built_in">getDeclaredFields</span>());</span><br><span class="line">            <span class="selector-tag">clazz</span> = <span class="selector-tag">clazz</span><span class="selector-class">.getSuperclass</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">fields</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="快速失败-Fail-Fast"><a href="#快速失败-Fail-Fast" class="headerlink" title="快速失败(Fail Fast)"></a>快速失败(Fail Fast)</h3><p>Spring Validation 默认会校验完所有字段，然后才抛出异常。可以通过一些简单的配置，开启 Fali Fast 模式，一旦校验失败就立即返回。</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@Bean</span></span><br><span class="line">public Validator validator() &#123;</span><br><span class="line">    ValidatorFactory validatorFactory = Validation<span class="selector-class">.byProvider</span>(HibernateValidator.class)</span><br><span class="line">            <span class="selector-class">.configure</span>()</span><br><span class="line">            <span class="comment">// 快速失败模式</span></span><br><span class="line">            <span class="selector-class">.failFast</span>(true)</span><br><span class="line">            <span class="selector-class">.buildValidatorFactory</span>();</span><br><span class="line">    return validatorFactory<span class="selector-class">.getValidator</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Spring-校验原理"><a href="#Spring-校验原理" class="headerlink" title="Spring 校验原理"></a>Spring 校验原理</h2><h3 id="Spring-校验使用场景"><a href="#Spring-校验使用场景" class="headerlink" title="Spring 校验使用场景"></a>Spring 校验使用场景</h3><ul>
<li>Spring 常规校验（Validator）</li>
<li>Spring 数据绑定（DataBinder）</li>
<li>Spring Web 参数绑定（WebDataBinder）</li>
<li>Spring WebMVC&#x2F;WebFlux 处理方法参数校验</li>
</ul>
<h3 id="Validator-接口设计"><a href="#Validator-接口设计" class="headerlink" title="Validator 接口设计"></a>Validator 接口设计</h3><ul>
<li>接口职责<ul>
<li>Spring 内部校验器接口，通过编程的方式校验目标对象</li>
</ul>
</li>
<li>核心方法<ul>
<li><code>supports(Class)</code>：校验目标类能否校验</li>
<li><code>validate(Object,Errors)</code>：校验目标对象，并将校验失败的内容输出至 Errors 对象</li>
</ul>
</li>
<li>配套组件<ul>
<li>错误收集器：<code>org.springframework.validation.Errors</code></li>
<li>Validator 工具类：<code>org.springframework.validation.ValidationUtils</code></li>
</ul>
</li>
</ul>
<h3 id="Errors-接口设计"><a href="#Errors-接口设计" class="headerlink" title="Errors 接口设计"></a>Errors 接口设计</h3><ul>
<li>接口职责<ul>
<li>数据绑定和校验错误收集接口，与 Java Bean 和其属性有强关联性</li>
</ul>
</li>
<li>核心方法<ul>
<li><code>reject</code> 方法（重载）：收集错误文案</li>
<li><code>rejectValue</code> 方法（重载）：收集对象字段中的错误文案</li>
</ul>
</li>
<li>配套组件<ul>
<li>Java Bean 错误描述：<code>org.springframework.validation.ObjectError</code></li>
<li>Java Bean 属性错误描述：<code>org.springframework.validation.FieldError</code></li>
</ul>
</li>
</ul>
<h3 id="Errors-文案来源"><a href="#Errors-文案来源" class="headerlink" title="Errors 文案来源"></a>Errors 文案来源</h3><p>Errors 文案生成步骤</p>
<ul>
<li>选择 Errors 实现（如：<code>org.springframework.validation.BeanPropertyBindingResult</code>）</li>
<li>调用 reject 或 rejectValue 方法</li>
<li>获取 Errors 对象中 ObjectError 或 FieldError</li>
<li>将 ObjectError 或 FieldError 中的 code 和 args，关联 MessageSource 实现（如：<code>ResourceBundleMessageSource</code>）</li>
</ul>
<h3 id="spring-web-校验原理"><a href="#spring-web-校验原理" class="headerlink" title="spring web 校验原理"></a>spring web 校验原理</h3><h4 id="RequestBody-参数校验实现原理"><a href="#RequestBody-参数校验实现原理" class="headerlink" title="RequestBody 参数校验实现原理"></a>RequestBody 参数校验实现原理</h4><p>在 spring-mvc 中，<code>RequestResponseBodyMethodProcessor</code> 是用于解析 <code>@RequestBody</code> 标注的参数以及处理<code>@ResponseBody</code> 标注方法的返回值的。其中，执行参数校验的逻辑肯定就在解析参数的方法 <code>resolveArgument()</code> 中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span></span><br><span class="line"><span class="params">    NativeWebRequest webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    parameter = parameter.nestedIfOptional();</span><br><span class="line">    <span class="type">Object</span> <span class="variable">arg</span> <span class="operator">=</span> readWithMessageConverters(webRequest, parameter, parameter.getNestedGenericParameterType());</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Conventions.getVariableNameForParameter(parameter);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (binderFactory != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">WebDataBinder</span> <span class="variable">binder</span> <span class="operator">=</span> binderFactory.createBinder(webRequest, arg, name);</span><br><span class="line">        <span class="keyword">if</span> (arg != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 尝试进行参数校验</span></span><br><span class="line">            validateIfApplicable(binder, parameter);</span><br><span class="line">            <span class="keyword">if</span> (binder.getBindingResult().hasErrors() &amp;&amp; isBindExceptionRequired(binder, parameter)) &#123;</span><br><span class="line">                <span class="comment">// 如果存在校验错误，则抛出 MethodArgumentNotValidException</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MethodArgumentNotValidException</span>(parameter, binder.getBindingResult());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mavContainer != <span class="literal">null</span>) &#123;</span><br><span class="line">            mavContainer.addAttribute(BindingResult.MODEL_KEY_PREFIX + name, binder.getBindingResult());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> adaptArgumentIfNecessary(arg, parameter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，resolveArgument()调用了 validateIfApplicable()进行参数校验。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">validateIfApplicable</span><span class="params">(WebDataBinder binder, MethodParameter parameter)</span> &#123;</span><br><span class="line">    <span class="comment">// 获取参数注解，如 @RequestBody、@Valid、@Validated</span></span><br><span class="line">    Annotation[] annotations = parameter.getParameterAnnotations();</span><br><span class="line">    <span class="keyword">for</span> (Annotation ann : annotations) &#123;</span><br><span class="line">        <span class="comment">// 先尝试获取 @Validated 注解</span></span><br><span class="line">        <span class="type">Validated</span> <span class="variable">validatedAnn</span> <span class="operator">=</span> AnnotationUtils.getAnnotation(ann, Validated.class);</span><br><span class="line">        <span class="comment">// 如果标注了 @Validated，直接开始校验。</span></span><br><span class="line">        <span class="comment">// 如果没有，那么判断参数前是否有 Valid 开头的注解。</span></span><br><span class="line">        <span class="keyword">if</span> (validatedAnn != <span class="literal">null</span> || ann.annotationType().getSimpleName().startsWith(<span class="string">&quot;Valid&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">hints</span> <span class="operator">=</span> (validatedAnn != <span class="literal">null</span> ? validatedAnn.value() : AnnotationUtils.getValue(ann));</span><br><span class="line">            Object[] validationHints = (hints <span class="keyword">instanceof</span> Object[] ? (Object[]) hints : <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123;hints&#125;);</span><br><span class="line">            <span class="comment">// 执行校验</span></span><br><span class="line">            binder.validate(validationHints);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码，就解释了 Spring 为什么能同时支持 <code>@Validated</code>、<code>@Valid</code> 两个注解。</p>
<p>接下来，看一下 WebDataBinder.validate() 的实现：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">validate</span>(<span class="params"><span class="title class_">Object</span> target, <span class="title class_">Errors</span> errors, <span class="title class_">Object</span>... validationHints</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">targetValidator</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title function_">processConstraintViolations</span>(</span><br><span class="line">            <span class="comment">// 此处调用 Hibernate Validator 执行真正的校验</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">targetValidator</span>.<span class="title function_">validate</span>(target, <span class="title function_">asValidationGroups</span>(validationHints)), errors);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上面代码，可以看出 Spring 校验实际上是基于 Hibernate Validator 的封装。</p>
<h4 id="方法级别的参数校验实现原理"><a href="#方法级别的参数校验实现原理" class="headerlink" title="方法级别的参数校验实现原理"></a>方法级别的参数校验实现原理</h4><p>Spring 支持根据方法去进行拦截、校验，原理就在于应用了 AOP 技术。具体来说，是通过 <code>MethodValidationPostProcessor</code> 动态注册 AOP 切面，然后使用 <code>MethodValidationInterceptor</code> 对切点方法织入增强。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodValidationPostProcessor</span> <span class="keyword">extends</span> <span class="title class_">AbstractBeanFactoryAwareAdvisingPostProcessorimplements</span> InitializingBean &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 为所有 @Validated 标注的 Bean 创建切面</span></span><br><span class="line">        <span class="type">Pointcut</span> <span class="variable">pointcut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationMatchingPointcut</span>(<span class="built_in">this</span>.validatedAnnotationType, <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// 创建 Advisor 进行增强</span></span><br><span class="line">        <span class="built_in">this</span>.advisor = <span class="keyword">new</span> <span class="title class_">DefaultPointcutAdvisor</span>(pointcut, createMethodValidationAdvice(<span class="built_in">this</span>.validator));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 Advice，本质就是一个方法拦截器</span></span><br><span class="line">    <span class="keyword">protected</span> Advice <span class="title function_">createMethodValidationAdvice</span><span class="params">(<span class="meta">@Nullable</span> Validator validator)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (validator != <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">MethodValidationInterceptor</span>(validator) : <span class="keyword">new</span> <span class="title class_">MethodValidationInterceptor</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着看一下 <code>MethodValidationInterceptor</code>：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public class MethodValidationInterceptor implements MethodInterceptor &#123;</span><br><span class="line">    <span class="keyword">@Override</span></span><br><span class="line">    public Object invoke(MethodInvocation invocation) throws Throwable &#123;</span><br><span class="line">        <span class="comment">// 无需增强的方法，直接跳过</span></span><br><span class="line">        if (isFactoryBeanMetadataMethod(invocation.getMethod())) &#123;</span><br><span class="line">            return invocation<span class="selector-class">.proceed</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取分组信息</span></span><br><span class="line">        Class&lt;?&gt;<span class="selector-attr">[]</span> groups = <span class="built_in">determineValidationGroups</span>(invocation);</span><br><span class="line">        ExecutableValidator execVal = this<span class="selector-class">.validator</span><span class="selector-class">.forExecutables</span>();</span><br><span class="line">        Method methodToValidate = invocation<span class="selector-class">.getMethod</span>();</span><br><span class="line">        Set&lt;ConstraintViolation&lt;<span class="selector-tag">Object</span>&gt;&gt; result;</span><br><span class="line">        try &#123;</span><br><span class="line">            <span class="comment">// 方法入参校验，最终还是委托给 Hibernate Validator 来校验</span></span><br><span class="line">            result = execVal<span class="selector-class">.validateParameters</span>(</span><br><span class="line">                invocation.getThis(), methodToValidate, invocation<span class="selector-class">.getArguments</span>(), groups);</span><br><span class="line">        &#125;</span><br><span class="line">        catch (IllegalArgumentException ex) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 有异常直接抛出</span></span><br><span class="line">        if (!result.isEmpty()) &#123;</span><br><span class="line">            throw new <span class="built_in">ConstraintViolationException</span>(result);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 真正的方法调用</span></span><br><span class="line">        <span class="selector-tag">Object</span> returnValue = invocation<span class="selector-class">.proceed</span>();</span><br><span class="line">        <span class="comment">// 对返回值做校验，最终还是委托给Hibernate Validator来校验</span></span><br><span class="line">        result = execVal<span class="selector-class">.validateReturnValue</span>(invocation.getThis(), methodToValidate, returnValue, groups);</span><br><span class="line">        <span class="comment">// 有异常直接抛出</span></span><br><span class="line">        if (!result.isEmpty()) &#123;</span><br><span class="line">            throw new <span class="built_in">ConstraintViolationException</span>(result);</span><br><span class="line">        &#125;</span><br><span class="line">        return returnValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际上，不管是 requestBody 参数校验还是方法级别的校验，最终都是调用 Hibernate Validator 执行校验，Spring Validation 只是做了一层封装。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p><strong>Spring 有哪些校验核心组件</strong>？</p>
<ul>
<li>检验器：<code>org.springframework.validation.Validator</code></li>
<li>错误收集器：<code>org.springframework.validation.Errors</code></li>
<li>Java Bean 错误描述：<code>org.springframework.validation.ObjectError</code></li>
<li>Java Bean 属性错误描述：<code>org.springframework.validation.FieldError</code></li>
<li>Bean Validation 适配：<code>org.springframework.validation.beanvalidation.LocalValidatorFactoryBean</code></li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/">https://dunwu.github.io/</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://coder-xuyong.github.io">coder-xuyong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://coder-xuyong.github.io/posts/c6c8fb67">https://coder-xuyong.github.io/posts/c6c8fb67</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://coder-xuyong.github.io" target="_blank">coder-xuyong</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Spring/">Spring</a><a class="post-meta__tags" href="/tags/%E6%A1%86%E6%9E%B6/">框架</a><a class="post-meta__tags" href="/tags/%E8%BD%AC%E8%BD%BD/">转载</a></div><div class="post-share"><div class="social-share" data-image="https://prod-alicdn-community.kurobbs.com/forum/dcdad1b7aa454b97b412899068f94aa620250313.jpg?x-oss-process=image%2Fformat%2Cwebp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/1465b468" title="SpringBoot 之快速入门"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/f59dff6fb93d4904b442d315738e6a6420250507.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">SpringBoot 之快速入门</div></div><div class="info-2"><div class="info-item-1">Spring Boot 简介Spring Boot 可以让使用者非常方便的创建 Spring 应用。 Spring Boot 的目标是：  为所有 Spring 开发者提供更快且可广泛访问的入门体验。 开箱即用 提供一系列通用的非功能特性（例如嵌入式服务、安全、指标、健康检查和外部化配置） 完全不需要代码生成，也不需要 XML 配置。  Spring Boot 系统要求Spring Boot 的构建工具要求：    Build Tool Version    Maven 3.5+   Gradle 6.8.x, 6.9.x, and 7.x   Spring Boot 支持的 Servlet 容器：    Name Servlet Version    Tomcat 9.0 4.0   Jetty 9.4 3.1   Jetty 10.0 4.0   Undertow 2.0 4.0   部署第一个 Spring Boot 项目 本节介绍如何开发一个小的“Hello World!” web 应用示例，来展示 Spring Boot 的一些关键功能。我们使用 Maven 来构建这个...</div></div></div></a><a class="pagination-related" href="/posts/c922b6d2" title="Spring 资源管理"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/86e33bf60c4d48499faa119f83e96fa120250619.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Spring 资源管理</div></div><div class="info-2"><div class="info-item-1">Spring 资源管理 Version 6.0.3  Resource 接口相对标准 URL 访问机制，Spring 的 org.springframework.core.io.Resource 接口抽象了对底层资源的访问接口，提供了一套更好的访问方式。 12345678910111213141516171819202122232425262728public interface Resource extends InputStreamSource &#123;    boolean exists();    boolean isReadable();    boolean isOpen();    boolean isFile();    URL getURL() throws IOException;    URI getURI() throws IOException;    File getFile() throws IOException;    ReadableByteChannel readableChannel() throws IOException;    l...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/cb377708" title="Spring Bean"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/43b6840836b84793980f93d5e9d786ce20250730.jpg?x-oss-process=image%2Fformat%2Cwebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-16</div><div class="info-item-2">Spring Bean</div></div><div class="info-2"><div class="info-item-1">Spring Bean在 Spring 中，构成应用程序主体由 Spring IoC 容器管理的对象称为 Bean。Bean 是由 Spring IoC 容器实例化、装配和管理的对象。 Bean 以及它们之间的依赖关系反映在容器使用的配置元数据中。 Spring Bean 定义BeanDefinitionSpring IoC 容器本身，并不能识别配置的元数据。为此，要将这些配置信息转为 Spring 能识别的格式——BeanDefinition 对象。 BeanDefinition 是 Spring 中定义 Bean 的配置元信息接口，它包含：  Bean 类名 Bean 行为配置元素，如：作用域、自动绑定的模式、生命周期回调等 其他 Bean 引用，也可称为合作者（Collaborators）或依赖（Dependencies） 配置设置，如 Bean 属性（Properties）  BeanDefinition 元信息BeanDefinition 元信息如下：    属性（Property） 说明    Class 全类名，必须是具体类，不能用抽象类或接口   Name Bea...</div></div></div></a><a class="pagination-related" href="/posts/2c3f8444" title="Spring 依赖查找"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/7f933184dd4747a0bb326ff1bca1eda720250730.jpg?x-oss-process=image%2Fformat%2Cwebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-02</div><div class="info-item-2">Spring 依赖查找</div></div><div class="info-2"><div class="info-item-1">Spring 依赖查找依赖查找是主动或手动的依赖查找方式，通常需要依赖容器或标准 API 实现。 IoC 依赖查找大致可以分为以下几类：  根据 Bean 名称查找 根据 Bean 类型查找 根据 Bean 名称 + 类型查找 根据 Java 注解查找  此外，根据查找的 Bean 对象是单一或集合对象，是否需要延迟查找等特定常见，有相应不同的 API。 单一类型依赖查找单一类型依赖查找接口- BeanFactory  根据 Bean 名称查找 getBean(String) Spring 2.5 覆盖默认参数：getBean(String,Object...)   根据 Bean 类型查找 Bean 实时查找 Spring 3.0 getBean(Class) Spring 4.1 覆盖默认参数：getBean(Class,Object...)   Spring 5.1 Bean 延迟查找 getBeanProvider(Class) getBeanProvider(ResolvableType)     根据 Bean 名称 + 类型查找：getBean(String,Cla...</div></div></div></a><a class="pagination-related" href="/posts/7a74b277" title="Spring IoC"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/43b6840836b84793980f93d5e9d786ce20250730.jpg?x-oss-process=image%2Fformat%2Cwebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-02</div><div class="info-item-2">Spring IoC</div></div><div class="info-2"><div class="info-item-1">IoC 简介IoC 是什么IoC 即控制反转（Inversion of Control，缩写为 IoC）。IoC 又称为依赖倒置原则（设计模式六大原则之一），它的要点在于：程序要依赖于抽象接口，不要依赖于具体实现。它的作用就是用于降低代码间的耦合度。 IoC 的实现方式有两种：  依赖注入（Dependency Injection，简称 DI）：不通过 new() 的方式在类内部创建依赖类对象，而是将依赖的类对象在外部创建好之后，通过构造函数、函数参数等方式传递（或注入）给类使用。 依赖查找（Dependency Lookup）：容器中的受控对象通过容器的 API 来查找自己所依赖的资源和协作对象。  IoC 能做什么IoC（控制反转）是一种设计思想，它的核心是：将对象的创建、依赖管理和生命周期的控制权从程序员手中转移到容器（框架）中。 IoC 和 DIDI（依赖注入）是 IoC（控制反转）的一种具体实现方式。  IoC是思想、是原则、是目标 DI是技术、是手段、是实现  IoC 容器IoC 容器就是具有依赖注入功能的容器。IoC 容器负责实例化、定位、配置应用程序中的对象及建立...</div></div></div></a><a class="pagination-related" href="/posts/fef2a625" title="Spring 依赖注入"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/dbc6de3bf3ec4db59f8ca4288cfa3e3c20250507.jpg?x-oss-process=image%2Fformat%2Cwebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-02</div><div class="info-item-2">Spring 依赖注入</div></div><div class="info-2"><div class="info-item-1">Spring 依赖注入DI，是 Dependency Injection 的缩写，即依赖注入。依赖注入是 IoC 的最常见形式。依赖注入是手动或自动绑定的方式，无需依赖特定的容器或 API。 依赖注入 (Dependency Injection，简称 DI) 是一个过程，其中对象仅通过构造函数参数、工厂方法的参数或对象实例在构造或从工厂方法返回。然后容器在创建 bean 时注入这些依赖项。这个过程基本上是 bean 本身的逆过程（因此得名，控制反转），它通过使用类的直接构造或服务定位器模式自行控制其依赖项的实例化或位置。 使用 DI，代码更干净，当对象具有依赖关系时，解耦更有效。对象不查找其依赖项，也不知道依赖项的位置或类别。结果，您的类变得更容易测试，特别是当依赖关系在接口或抽象基类上时，它们允许在单元测试中使用存根或模拟实现。 容器全权负责组件的装配，它会把符合依赖关系的对象通过 JavaBean 属性或者构造函数传递给需要的对象。 DI 是组件之间依赖关系由容器在运行期决定，形象的说，即由容器动态的将某个依赖关系注入到组件之中。依赖注入的目的并非为软件系统带来更多功能，而是...</div></div></div></a><a class="pagination-related" href="/posts/7d67d9e0" title="Spring IoC 依赖来源"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/8cff74db40294c4c9532f964cc2065b720250408.jpg?x-oss-process=image%2Fformat%2Cwebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-09</div><div class="info-item-2">Spring IoC 依赖来源</div></div><div class="info-2"><div class="info-item-1">依赖查找的来源查找来源    来源 配置元数据    Spring BeanDefinition &lt;bean id =&quot;user&quot; class=&quot;xxx.xxx.User&quot;&gt;    @Bean public User user() &#123;...&#125;    BeanDefinitionBuilder   单例对象 API 实现   Spring 內建 BeanDefintion    Bean 名称 Bean 实例 使用场景    org.springframework.context.annotation.internalConfigurationAnnotationProcessor ConfigurationClassPostProcessor 对象 处理 Spring 配置类   org.springframework.context.annotation.internalAutowiredAnnotationProcessor AutowiredAnnotationBeanPostProcessor 对象 ...</div></div></div></a><a class="pagination-related" href="/posts/c922b6d2" title="Spring 资源管理"><img class="cover" src="https://prod-alicdn-community.kurobbs.com/forum/86e33bf60c4d48499faa119f83e96fa120250619.jpg?x-oss-process=image%2Fformat%2Cwebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-09</div><div class="info-item-2">Spring 资源管理</div></div><div class="info-2"><div class="info-item-1">Spring 资源管理 Version 6.0.3  Resource 接口相对标准 URL 访问机制，Spring 的 org.springframework.core.io.Resource 接口抽象了对底层资源的访问接口，提供了一套更好的访问方式。 12345678910111213141516171819202122232425262728public interface Resource extends InputStreamSource &#123;    boolean exists();    boolean isReadable();    boolean isOpen();    boolean isFile();    URL getURL() throws IOException;    URI getURI() throws IOException;    File getFile() throws IOException;    ReadableByteChannel readableChannel() throws IOException;    l...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/medias/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">coder-xuyong</div><div class="author-info-description">生如牛马不得闲</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">100</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">97</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">45</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/coder-xuyong"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.</span> <span class="toc-text">Spring 校验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.1.</span> <span class="toc-text">快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">1.1.1.</span> <span class="toc-text">引入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">校验示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.1.3.</span> <span class="toc-text">统一异常处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">进阶使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.2.1.</span> <span class="toc-text">分组校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.2.2.</span> <span class="toc-text">嵌套校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.2.3.</span> <span class="toc-text">自定义校验注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.2.4.</span> <span class="toc-text">自定义校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%A4%B1%E8%B4%A5-Fail-Fast"><span class="toc-number">1.2.5.</span> <span class="toc-text">快速失败(Fail Fast)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-%E6%A0%A1%E9%AA%8C%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">Spring 校验原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-%E6%A0%A1%E9%AA%8C%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.3.1.</span> <span class="toc-text">Spring 校验使用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Validator-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.2.</span> <span class="toc-text">Validator 接口设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Errors-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.3.</span> <span class="toc-text">Errors 接口设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Errors-%E6%96%87%E6%A1%88%E6%9D%A5%E6%BA%90"><span class="toc-number">1.3.4.</span> <span class="toc-text">Errors 文案来源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-web-%E6%A0%A1%E9%AA%8C%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.5.</span> <span class="toc-text">spring web 校验原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RequestBody-%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">RequestBody 参数校验实现原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.5.2.</span> <span class="toc-text">方法级别的参数校验实现原理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">1.5.</span> <span class="toc-text">参考资料</span></a></li></ol></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>Sring核心</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/ebd5b707" title="SpringBoot 之 Profile"><img src="https://prod-alicdn-community.kurobbs.com/forum/dbc6de3bf3ec4db59f8ca4288cfa3e3c20250507.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot 之 Profile"></a><div class="content"><a class="title" href="/posts/ebd5b707" title="SpringBoot 之 Profile">SpringBoot 之 Profile</a><time datetime="2025-10-13T12:55:01.000Z" title="发表于 2025-10-13 20:55:01">2025-10-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/32907b42" title="SpringBoot 之属性加载详解"><img src="https://prod-alicdn-community.kurobbs.com/forum/6edb712c4a9a46bb843646404a0ff2db20250904.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot 之属性加载详解"></a><div class="content"><a class="title" href="/posts/32907b42" title="SpringBoot 之属性加载详解">SpringBoot 之属性加载详解</a><time datetime="2025-10-13T11:55:54.000Z" title="发表于 2025-10-13 19:55:54">2025-10-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1465b468" title="SpringBoot 之快速入门"><img src="https://prod-alicdn-community.kurobbs.com/forum/f59dff6fb93d4904b442d315738e6a6420250507.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot 之快速入门"></a><div class="content"><a class="title" href="/posts/1465b468" title="SpringBoot 之快速入门">SpringBoot 之快速入门</a><time datetime="2025-10-13T10:22:26.000Z" title="发表于 2025-10-13 18:22:26">2025-10-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c6c8fb67" title="Spring 校验"><img src="https://prod-alicdn-community.kurobbs.com/forum/dcdad1b7aa454b97b412899068f94aa620250313.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring 校验"></a><div class="content"><a class="title" href="/posts/c6c8fb67" title="Spring 校验">Spring 校验</a><time datetime="2025-10-09T14:58:41.000Z" title="发表于 2025-10-09 22:58:41">2025-10-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c922b6d2" title="Spring 资源管理"><img src="https://prod-alicdn-community.kurobbs.com/forum/86e33bf60c4d48499faa119f83e96fa120250619.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring 资源管理"></a><div class="content"><a class="title" href="/posts/c922b6d2" title="Spring 资源管理">Spring 资源管理</a><time datetime="2025-10-09T13:46:41.000Z" title="发表于 2025-10-09 21:46:41">2025-10-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/655d86b3" title="Spring AOP"><img src="https://prod-alicdn-community.kurobbs.com/forum/dddd5d37f41343ac9c0b9500f111fbae20250423.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring AOP"></a><div class="content"><a class="title" href="/posts/655d86b3" title="Spring AOP">Spring AOP</a><time datetime="2025-10-09T12:47:47.000Z" title="发表于 2025-10-09 20:47:47">2025-10-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7d67d9e0" title="Spring IoC 依赖来源"><img src="https://prod-alicdn-community.kurobbs.com/forum/8cff74db40294c4c9532f964cc2065b720250408.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring IoC 依赖来源"></a><div class="content"><a class="title" href="/posts/7d67d9e0" title="Spring IoC 依赖来源">Spring IoC 依赖来源</a><time datetime="2025-10-09T12:33:51.000Z" title="发表于 2025-10-09 20:33:51">2025-10-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/fef2a625" title="Spring 依赖注入"><img src="https://prod-alicdn-community.kurobbs.com/forum/dbc6de3bf3ec4db59f8ca4288cfa3e3c20250507.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring 依赖注入"></a><div class="content"><a class="title" href="/posts/fef2a625" title="Spring 依赖注入">Spring 依赖注入</a><time datetime="2025-10-02T09:06:10.000Z" title="发表于 2025-10-02 17:06:10">2025-10-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2c3f8444" title="Spring 依赖查找"><img src="https://prod-alicdn-community.kurobbs.com/forum/7f933184dd4747a0bb326ff1bca1eda720250730.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring 依赖查找"></a><div class="content"><a class="title" href="/posts/2c3f8444" title="Spring 依赖查找">Spring 依赖查找</a><time datetime="2025-10-02T08:06:10.000Z" title="发表于 2025-10-02 16:06:10">2025-10-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7a74b277" title="Spring IoC"><img src="https://prod-alicdn-community.kurobbs.com/forum/43b6840836b84793980f93d5e9d786ce20250730.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring IoC"></a><div class="content"><a class="title" href="/posts/7a74b277" title="Spring IoC">Spring IoC</a><time datetime="2025-10-02T00:06:10.000Z" title="发表于 2025-10-02 08:06:10">2025-10-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cb377708" title="Spring Bean"><img src="https://prod-alicdn-community.kurobbs.com/forum/43b6840836b84793980f93d5e9d786ce20250730.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Bean"></a><div class="content"><a class="title" href="/posts/cb377708" title="Spring Bean">Spring Bean</a><time datetime="2025-09-16T11:53:30.000Z" title="发表于 2025-09-16 19:53:30">2025-09-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/43b74d60" title="Spring Framework 综述"><img src="https://prod-alicdn-community.kurobbs.com/forum/5803ca9faed74b0080a1156e0ef93aae20250529.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Framework 综述"></a><div class="content"><a class="title" href="/posts/43b74d60" title="Spring Framework 综述">Spring Framework 综述</a><time datetime="2025-09-16T10:53:30.000Z" title="发表于 2025-09-16 18:53:30">2025-09-16</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/c16f2ba9" title="ForkJoin框架"><img src="https://prod-alicdn-community.kurobbs.com/forum/7f933184dd4747a0bb326ff1bca1eda720250730.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ForkJoin框架"/></a><div class="content"><a class="title" href="/posts/c16f2ba9" title="ForkJoin框架">ForkJoin框架</a><time datetime="2025-10-18T07:27:46.000Z" title="发表于 2025-10-18 15:27:46">2025-10-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/91e798bc" title="Java内存模型"><img src="https://prod-alicdn-community.kurobbs.com/forum/5803ca9faed74b0080a1156e0ef93aae20250529.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java内存模型"/></a><div class="content"><a class="title" href="/posts/91e798bc" title="Java内存模型">Java内存模型</a><time datetime="2025-10-18T02:43:11.000Z" title="发表于 2025-10-18 10:43:11">2025-10-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/19b32c42" title="Java并发工具类"><img src="https://prod-alicdn-community.kurobbs.com/forum/dcdad1b7aa454b97b412899068f94aa620250313.jpg?x-oss-process=image%2Fformat%2Cwebp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java并发工具类"/></a><div class="content"><a class="title" href="/posts/19b32c42" title="Java并发工具类">Java并发工具类</a><time datetime="2025-10-17T15:52:25.000Z" title="发表于 2025-10-17 23:52:25">2025-10-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://prod-alicdn-community.kurobbs.com/forum/dcdad1b7aa454b97b412899068f94aa620250313.jpg?x-oss-process=image%2Fformat%2Cwebp);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By coder-xuyong</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div><div class="footer_custom_text">Hi, welcome to coder-xuyong's <a href="https://coder-xuyong.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><!-- butterfly右下角悬浮菜单栏 百分比--><span id="percent">0</span></button><!-- butterfly右下角悬浮菜单栏 直达底部--><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  const initGitalk = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyGitalk = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const gitalk = new Gitalk({
      clientID: 'Ov23li4gzANXxmx9072g',
      clientSecret: 'b4da9f4490b2864bfdee5df73655329a642c6112',
      repo: 'coder-xuyong.github.io',
      owner: 'coder-xuyong',
      admin: ['coder-xuyong'],
      updateCountCallback: commentCount,
      ...option,
      id: isShuoshuo ? path : (option && option.id) || 'd4d1ccaa994b18a1d3cda7336c535dff'
    })

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async(el, path) => {
    if (typeof Gitalk === 'function') initGitalk(el, path)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js')
      initGitalk(el, path)
    }
  }

  if (isShuoshuo) {
    'Gitalk' === 'Gitalk'
      ? window.shuoshuoComment = { loadComment: loadGitalk }
      : window.loadOtherComment = loadGitalk
    return
  }

  if ('Gitalk' === 'Gitalk' || !true) {
    if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script src="/self/custom.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="https://cn.vercount.one/js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="search key word" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>